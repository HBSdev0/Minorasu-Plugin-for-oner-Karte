!function(){"use strict";function e(e){const{roa:t,propertyDetails:n}=e,a=document.createElement("div");a.className="tab-content active",a.dataset.tab="roa";const o=n.map((e,t)=>{var n,a,o,r,i,l,d,c,u,s;const p=parseFloat((null==(n=e.market_price)?void 0:n.value)||0),m=parseFloat((null==(a=e.income)?void 0:a.value)||0),v=parseFloat((null==(o=e.inheritance_tax_value)?void 0:o.value)||0),y=v>0?p/v*100:0,g=v>0?m/v*100:0;return`\n        <tr data-prop-index="${t}" data-scenario="current" class="readonly-row">\n            <td rowspan="2">${(null==(r=e.property_name)?void 0:r.value)??""}</td>\n            <td>現状</td>\n            <td><input type="text" id="roaProp_${t}_current_market" value="${(null==(i=e.market_price)?void 0:i.value)??0}" readonly></td>\n            <td><input type="text" id="roaProp_${t}_current_income" value="${(null==(l=e.income)?void 0:l.value)??0}" readonly></td>\n            <td><input type="text" id="roaProp_${t}_current_inheritance" value="${(null==(d=e.inheritance_tax_value)?void 0:d.value)??0}" readonly></td>\n            <td><input type="text" id="roaProp_${t}_current_assetEfficiency" value="${y.toFixed(1)}" readonly></td>\n            <td><input type="text" id="roaProp_${t}_current_roa" value="${g.toFixed(1)}" readonly></td>\n        </tr>\n        <tr data-prop-index="${t}" data-scenario="forecast">\n            <td>試算</td>\n            <td><input type="text" id="roaProp_${t}_forecast_market" value="${(null==(c=e.market_price)?void 0:c.value)??0}"></td>\n            <td><input type="text" id="roaProp_${t}_forecast_income" value="${(null==(u=e.income)?void 0:u.value)??0}"></td>\n            <td><input type="text" id="roaProp_${t}_forecast_inheritance" value="${(null==(s=e.inheritance_tax_value)?void 0:s.value)??0}"></td>\n            <td><input type="text" id="roaProp_${t}_forecast_assetEfficiency" value="${y.toFixed(1)}" readonly></td>\n            <td><input type="text" id="roaProp_${t}_forecast_roa" value="${g.toFixed(1)}" readonly></td>\n        </tr>\n    `}).join("");function r(e){return(null==e?"":String(e)).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function i(e){const t=(e||"").toString().replace(/,/g,""),n=parseFloat(t);return isNaN(n)?0:n}function l(e){const t=(e.value||"").replace(/,/g,"");t&&!isNaN(t)&&(e.value=r(t))}function d(){const e=n.length;let t=0,a=0,o=0,l=0,d=0,c=0;for(let n=0;n<e;n++){t+=i(document.getElementById(`roaProp_${n}_current_market`).value),a+=i(document.getElementById(`roaProp_${n}_current_income`).value),o+=i(document.getElementById(`roaProp_${n}_current_inheritance`).value);l+=i(document.getElementById(`roaProp_${n}_forecast_market`).value),d+=i(document.getElementById(`roaProp_${n}_forecast_income`).value),c+=i(document.getElementById(`roaProp_${n}_forecast_inheritance`).value)}document.getElementById("roaTblCurrentMarketPrice").value=r(t),document.getElementById("roaTblCurrentIncome").value=r(a),document.getElementById("roaTblCurrentInheritance").value=r(o),document.getElementById("roaTblForecastMarketPrice").value=r(l),document.getElementById("roaTblForecastIncome").value=r(d),document.getElementById("roaTblForecastInheritance").value=r(c);const u=o>0?t/o*100:0,s=c>0?l/c*100:0,p=o>0?a/o*100:0,m=c>0?d/c*100:0;document.getElementById("roaTblCurrentAssetEfficiency").value=u.toFixed(1),document.getElementById("roaTblCurrentRoa").value=p.toFixed(1),document.getElementById("roaTblForecastAssetEfficiency").value=s.toFixed(1),document.getElementById("roaTblForecastRoa").value=m.toFixed(1);const v=document.getElementById("roaCurrent"),y=document.getElementById("roaForecast");v&&(v.value=p.toFixed(1),v.dispatchEvent(new Event("input",{bubbles:!0}))),y&&(y.value=m.toFixed(1),y.dispatchEvent(new Event("input",{bubbles:!0})))}function c(){d()}function u(){d()}function s(e,t){const n=document.getElementById(`roaProp_${e}_${t}_market`),a=document.getElementById(`roaProp_${e}_${t}_income`),o=document.getElementById(`roaProp_${e}_${t}_inheritance`),r=document.getElementById(`roaProp_${e}_${t}_assetEfficiency`),l=document.getElementById(`roaProp_${e}_${t}_roa`);if(!(n&&a&&o&&r&&l))return;const c=i(n.value),u=i(a.value),s=i(o.value),p=s>0?c/s*100:0,m=s>0?u/s*100:0;r.value=p.toFixed(1),l.value=m.toFixed(1),d()}a.innerHTML=`\n        <div class="form-container">\n            <table class="roa-table">\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th>実勢価格</th>\n                        <th>収支</th>\n                        <th>相続税評価額</th>\n                        <th>資産効率(%)</th>\n                        <th>ROA(%)</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr>\n                        <td class="row-label">現状値</td>\n                        <td><input type="text" id="roaTblCurrentMarketPrice" value="0" readonly></td>\n                        <td><input type="text" id="roaTblCurrentIncome" value="0" readonly></td>\n                        <td><input type="text" id="roaTblCurrentInheritance" value="0" readonly></td>\n                        <td><input type="text" id="roaTblCurrentAssetEfficiency" value="0.0" readonly></td>\n                        <td><input type="text" id="roaTblCurrentRoa" value="0.0" readonly></td>\n                    </tr>\n                    <tr>\n                        <td class="row-label">試算値</td>\n                        <td><input type="text" id="roaTblForecastMarketPrice" value="0" readonly></td>\n                        <td><input type="text" id="roaTblForecastIncome" value="0" readonly></td>\n                        <td><input type="text" id="roaTblForecastInheritance" value="0" readonly></td>\n                        <td><input type="text" id="roaTblForecastAssetEfficiency" value="0.0" readonly></td>\n                        <td><input type="text" id="roaTblForecastRoa" value="0.0" readonly></td>\n                    </tr>\n                </tbody>\n            </table>\n\n            <table class="roa-pivot-table">\n                <thead>\n                    <tr>\n                        <th>物件名</th>\n                        <th>現状/試算</th>\n                        <th>実勢価格</th>\n                        <th>収支</th>\n                        <th>相続税評価額</th>\n                        <th>資産効率(%)</th>\n                        <th>ROA(%)</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${o}\n                </tbody>\n            </table>\n\n            <div class="calculation-formula-container">\n                <div class="formula-content">\n                    <p>資産効率 = 実勢価格 ÷ 相続税評価額 × 100</p>\n                    <p>ROA = 収支 ÷ 相続税評価額 × 100</p>\n                </div>\n            </div>\n\n            \x3c!-- トップ表/チャート連携用（非表示） --\x3e\n            <input type="number" id="roaCurrent" value="${t.current}" min="0" max="50" step="0.1" style="display:none;">\n            <input type="number" id="roaForecast" value="${t.forecast}" min="0" max="50" step="0.1" style="display:none;">\n        </div>\n    `;const p=document.getElementById("roaTblCurrentRoa");p&&(p.value=Number(t.current||0).toFixed(1));const m=document.getElementById("roaTblForecastRoa");return m&&(m.value=Number(t.forecast||0).toFixed(1)),["roaTblForecastMarketPrice","roaTblForecastIncome","roaTblForecastInheritance"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("input",e=>{l(e.target),c()}),t.addEventListener("blur",e=>{l(e.target)}))}),["roaTblCurrentMarketPrice","roaTblCurrentIncome","roaTblCurrentInheritance"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("input",e=>{l(e.target),u()}),t.addEventListener("blur",e=>{l(e.target)}))}),setTimeout(()=>{["roaTblCurrentMarketPrice","roaTblCurrentIncome","roaTblCurrentInheritance","roaTblForecastMarketPrice","roaTblForecastIncome","roaTblForecastInheritance"].forEach(e=>{const t=document.getElementById(e);t&&l(t)}),u(),c();const e=n.length;for(let t=0;t<e;t++)["current","forecast"].forEach(e=>{["market","income","inheritance"].forEach(n=>{const a=document.getElementById(`roaProp_${t}_${e}_${n}`);a&&l(a)}),s(t,e)});!function(){const e=n.length;for(let t=0;t<e;t++)["market","income","inheritance"].forEach(e=>{const n=document.getElementById(`roaProp_${t}_forecast_${e}`);n&&(n.addEventListener("input",e=>{l(e.target),s(t,"forecast")}),n.addEventListener("blur",e=>{l(e.target)}))})}()},0),a}function t(e){const{operatingCost:t,propertyDetails:n}=e,a=document.createElement("div");a.className="tab-content",a.dataset.tab="operatingCost";const o=n.map((e,t)=>{var n,a,o,r,i,l,d,c,u,s,p,m,v,y,g;return`\n        <tr data-prop-index="${t}" data-scenario="current" class="readonly-row">\n            <td rowspan="2">${(null==(n=e.property_name)?void 0:n.value)??""}</td>\n            <td>現状</td>\n            <td><input type="text" id="operatingCostProp_${t}_current_rate" value="0.0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_noiRate" value="0.0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_propertyTax" value="${(null==(a=e.property_tax)?void 0:a.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_management" value="${(null==(o=e.management_fee)?void 0:o.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_repair" value="${(null==(r=e.building_repair_cost)?void 0:r.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_restoration" value="${(null==(i=e.restoration_cost)?void 0:i.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_maintenance" value="${(null==(l=e.maintenance_cost)?void 0:l.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_netIncome" value="${(null==(d=e.net_income)?void 0:d.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_fullRent" value="${(null==(c=e.full_rent)?void 0:c.value)??0}" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_totalCost" value="0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_current_noi" value="0" readonly></td>\n        </tr>\n        <tr data-prop-index="${t}" data-scenario="forecast">\n            <td>試算</td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_rate" value="0.0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_noiRate" value="0.0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_propertyTax" value="${(null==(u=e.property_tax)?void 0:u.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_management" value="${(null==(s=e.management_fee)?void 0:s.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_repair" value="${(null==(p=e.building_repair_cost)?void 0:p.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_restoration" value="${(null==(m=e.restoration_cost)?void 0:m.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_maintenance" value="${(null==(v=e.maintenance_cost)?void 0:v.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_netIncome" value="${(null==(y=e.net_income)?void 0:y.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_fullRent" value="${(null==(g=e.full_rent)?void 0:g.value)??0}"></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_totalCost" value="0" readonly></td>\n            <td><input type="text" id="operatingCostProp_${t}_forecast_noi" value="0" readonly></td>\n        </tr>\n    `}).join("");function r(e){return(null==e?"":String(e)).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function i(e){const t=(e||"").toString().replace(/,/g,""),n=parseFloat(t);return isNaN(n)?0:n}function l(e){const t=(e.value||"").replace(/,/g,"");t&&!isNaN(t)&&(e.value=r(t))}function d(){const e=n.length;let t=0,a=0,o=0,l=0,d=0,c=0,u=0,s=0,p=0,m=0,v=0,y=0,g=0,x=0;for(let n=0;n<e;n++)t+=i(document.getElementById(`operatingCostProp_${n}_current_propertyTax`).value),a+=i(document.getElementById(`operatingCostProp_${n}_current_management`).value),o+=i(document.getElementById(`operatingCostProp_${n}_current_repair`).value),l+=i(document.getElementById(`operatingCostProp_${n}_current_restoration`).value),d+=i(document.getElementById(`operatingCostProp_${n}_current_maintenance`).value),c+=i(document.getElementById(`operatingCostProp_${n}_current_netIncome`).value),u+=i(document.getElementById(`operatingCostProp_${n}_current_fullRent`).value),s+=i(document.getElementById(`operatingCostProp_${n}_forecast_propertyTax`).value),p+=i(document.getElementById(`operatingCostProp_${n}_forecast_management`).value),m+=i(document.getElementById(`operatingCostProp_${n}_forecast_repair`).value),v+=i(document.getElementById(`operatingCostProp_${n}_forecast_restoration`).value),y+=i(document.getElementById(`operatingCostProp_${n}_forecast_maintenance`).value),g+=i(document.getElementById(`operatingCostProp_${n}_forecast_netIncome`).value),x+=i(document.getElementById(`operatingCostProp_${n}_forecast_fullRent`).value);document.getElementById("operatingCostTblCurrentPropertyTax").value=r(t),document.getElementById("operatingCostTblCurrentManagement").value=r(a),document.getElementById("operatingCostTblCurrentRepair").value=r(o),document.getElementById("operatingCostTblCurrentRestoration").value=r(l),document.getElementById("operatingCostTblCurrentMaintenance").value=r(d),document.getElementById("operatingCostTblCurrentNetIncome").value=r(c),document.getElementById("operatingCostTblCurrentFullRent").value=r(u),document.getElementById("operatingCostTblForecastPropertyTax").value=r(s),document.getElementById("operatingCostTblForecastManagement").value=r(p),document.getElementById("operatingCostTblForecastRepair").value=r(m),document.getElementById("operatingCostTblForecastRestoration").value=r(v),document.getElementById("operatingCostTblForecastMaintenance").value=r(y),document.getElementById("operatingCostTblForecastNetIncome").value=r(g),document.getElementById("operatingCostTblForecastFullRent").value=r(x);const h=t+a+o+l+d,_=s+p+m+v+y;document.getElementById("operatingCostTblCurrentTotalCost").value=r(h),document.getElementById("operatingCostTblForecastTotalCost").value=r(_);const f=u>0?h/u*100:0,b=x>0?_/x*100:0;document.getElementById("operatingCostTblCurrentRate").value=f.toFixed(1),document.getElementById("operatingCostTblForecastRate").value=b.toFixed(1);const T=c-h,C=g-_;document.getElementById("operatingCostTblCurrentNoi").value=r(T),document.getElementById("operatingCostTblForecastNoi").value=r(C);const I=u>0?T/u*100:0,E=x>0?C/x*100:0;document.getElementById("operatingCostTblCurrentNoiRate").value=I.toFixed(1),document.getElementById("operatingCostTblForecastNoiRate").value=E.toFixed(1);const $=document.getElementById("operatingCostCurrent"),F=document.getElementById("operatingCostForecast");$&&($.value=f.toFixed(1),$.dispatchEvent(new Event("input",{bubbles:!0}))),F&&(F.value=b.toFixed(1),F.dispatchEvent(new Event("input",{bubbles:!0})))}function c(e,t){const n=document.getElementById(`operatingCostProp_${e}_${t}_propertyTax`),a=document.getElementById(`operatingCostProp_${e}_${t}_management`),o=document.getElementById(`operatingCostProp_${e}_${t}_repair`),l=document.getElementById(`operatingCostProp_${e}_${t}_restoration`),c=document.getElementById(`operatingCostProp_${e}_${t}_maintenance`),u=document.getElementById(`operatingCostProp_${e}_${t}_netIncome`),s=document.getElementById(`operatingCostProp_${e}_${t}_fullRent`),p=document.getElementById(`operatingCostProp_${e}_${t}_totalCost`),m=document.getElementById(`operatingCostProp_${e}_${t}_noi`),v=document.getElementById(`operatingCostProp_${e}_${t}_rate`),y=document.getElementById(`operatingCostProp_${e}_${t}_noiRate`);if(!(n&&a&&o&&l&&c&&u&&s&&p&&m&&v&&y))return;const g=i(n.value),x=i(a.value),h=i(o.value),_=i(l.value),f=i(c.value),b=i(u.value),T=i(s.value),C=g+x+h+_+f,I=T>0?C/T*100:0,E=b-C,$=T>0?E/T*100:0;p.value=r(C),v.value=I.toFixed(1),m.value=r(E),y.value=$.toFixed(1),d()}a.innerHTML=`\n        <div class="form-container">\n            <table class="operating-cost-table">\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th>運営コスト率(%)</th>\n                        <th>NOI率(%)</th>\n                        <th>固都税</th>\n                        <th>管理料</th>\n                        <th>建物修繕費</th>\n                        <th>原状回復費</th>\n                        <th>メンテ経費</th>\n                        <th>実質収入</th>\n                        <th>満室賃料</th>\n                        <th>運営コスト合計</th>\n                        <th>NOI</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr>\n                        <td class="row-label">現状値</td>\n                        <td><input type="text" id="operatingCostTblCurrentRate" value="0.0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentNoiRate" value="0.0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentPropertyTax" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentManagement" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentRepair" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentRestoration" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentMaintenance" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentNetIncome" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentFullRent" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentTotalCost" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblCurrentNoi" value="0" readonly></td>\n                    </tr>\n                    <tr>\n                        <td class="row-label">試算値</td>\n                        <td><input type="text" id="operatingCostTblForecastRate" value="0.0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastNoiRate" value="0.0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastPropertyTax" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastManagement" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastRepair" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastRestoration" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastMaintenance" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastNetIncome" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastFullRent" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastTotalCost" value="0" readonly></td>\n                        <td><input type="text" id="operatingCostTblForecastNoi" value="0" readonly></td>\n                    </tr>\n                </tbody>\n            </table>\n\n            <table class="operating-cost-pivot-table">\n                <thead>\n                    <tr>\n                        <th>物件名</th>\n                        <th>現状/試算</th>\n                        <th>運営コスト率(%)</th>\n                        <th>NOI率(%)</th>\n                        <th>固都税</th>\n                        <th>管理料</th>\n                        <th>建物修繕費</th>\n                        <th>原状回復費</th>\n                        <th>メンテ経費</th>\n                        <th>実質収入</th>\n                        <th>満室賃料</th>\n                        <th>運営コスト合計</th>\n                        <th>NOI</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${o}\n                </tbody>\n            </table>\n\n            <div class="calculation-formula-container">\n                <div class="formula-content">\n                    <p>運営コスト合計 = 固都税 + 管理料 + 建物修繕費 + 原状回復費 + メンテ経費</p>\n                    <p>運営コスト率 = 運営コスト合計 ÷ 満室賃料 × 100</p>\n                    <p>NOI = 実質収入 - 運営コスト合計</p>\n                    <p>NOI率 = NOI ÷ 満室賃料 × 100</p>\n            </div>\n            </div>\n\n            \x3c!-- トップ表/チャート連携用（非表示） --\x3e\n            <input type="number" id="operatingCostCurrent" value="${t.current}" min="0" max="100" step="0.1" style="display:none;">\n            <input type="number" id="operatingCostForecast" value="${t.forecast}" min="0" max="100" step="0.1" style="display:none;">\n        </div>\n    `;const u=document.getElementById("operatingCostTblCurrentRate");u&&(u.value=Number(t.current||0).toFixed(1));const s=document.getElementById("operatingCostTblForecastRate");return s&&(s.value=Number(t.forecast||0).toFixed(1)),setTimeout(()=>{d();const e=n.length;for(let t=0;t<e;t++)["current","forecast"].forEach(e=>{["propertyTax","management","repair","restoration","maintenance","netIncome","fullRent"].forEach(n=>{const a=document.getElementById(`operatingCostProp_${t}_${e}_${n}`);a&&l(a)}),c(t,e)});!function(){const e=n.length;for(let t=0;t<e;t++)["propertyTax","management","repair","restoration","maintenance","netIncome","fullRent"].forEach(e=>{const n=document.getElementById(`operatingCostProp_${t}_forecast_${e}`);n&&(n.addEventListener("input",e=>{l(e.target),c(t,"forecast")}),n.addEventListener("blur",e=>{l(e.target)}))})}()},0),a}!function(){const n=kintone.$PLUGIN_ID;let a=kintone.plugin.app.getConfig(n);if("string"==typeof a)try{a=JSON.parse(a)}catch(h){a={}}if(!(a&&a.spaceId&&a.ownerAppId&&a.propertyAppId))return;let o=null,r=null,i=!1;const l=["assetEfficiency","roa","incomeTax","operatingCost","noi"],d=["current","average","forecast"],c=["資産効率(%)","ROA(%)","所得税率(%)","運営コスト率(%)","NOI率(%)"],u=[{label:"現状",border:"rgb(52, 152, 219)",bgRadar:"rgba(52, 152, 219, 0.2)",bgBar:"rgba(52, 152, 219, 0.8)",bwRadar:2,bwBar:1},{label:"平均",border:"rgb(231, 76, 60)",bgRadar:"rgba(231, 76, 60, 0.2)",bgBar:"rgba(231, 76, 60, 0.8)",bwRadar:2,bwBar:1},{label:"試算",border:"rgb(46, 204, 113)",bgRadar:"rgba(46, 204, 113, 0.2)",bgBar:"rgba(46, 204, 113, 0.8)",bwRadar:2,bwBar:1}];let s={};async function p(e,t="",n=500){const a=[];let o=null,r=!0,i=0,l=0;for(;r;)try{const d={app:e,query:t,fields:[],totalCount:!0};o&&(d.query=t?`${t} and $id > ${o}`:`$id > ${o}`);const c=await kintone.api("/k/v1/records.json","GET",d);c.records&&c.records.length>0?(a.push(...c.records),o=c.records[c.records.length-1].$id.value,i+=c.records.length,i%1e3==0||c.records.length,c.records.length<n&&(r=!1),l=0):r=!1}catch(d){if(console.error(`BI Dashboard Plugin: アプリ${e}のレコード取得エラー (試行${l+1}/3):`,d),l++,l>=3)console.error(`BI Dashboard Plugin: アプリ${e}のレコード取得を最大リトライ回数に達したため終了`),r=!1;else{const e=1e3*Math.pow(2,l);await new Promise(t=>setTimeout(t,e))}}return a.length,{records:a}}function m(e){return e.charAt(0).toUpperCase()+e.slice(1)}function v(){document.querySelectorAll("#dataTable tbody tr").forEach((e,t)=>{const n=l[t];if(!n||!s[n])return;const a=s[n],o=e.querySelectorAll("td");o.length<4||(o[1].textContent=a.current.toFixed(1),o[2].textContent=a.average.toFixed(1),o[3].textContent=a.forecast.toFixed(1))})}function y(e,t=s){return i?l.map(n=>{const a=t[n].average,o=t[n].current,r=t[n].forecast;return"current"===e?a>0?o/a:0:"forecast"===e?a>0?r/a:0:1}):l.map(n=>t[n][e])}function g(){x(),d.forEach((e,t)=>{const n=y(e);o.data.datasets[t].data=n,r.data.datasets[t].data=n}),o.update(),r.update()}function x(){if(i){const e=Math.max(...l.map(e=>{const t=s[e].current,n=s[e].forecast,a=s[e].average,o=a>0?t/a:0,r=a>0?n/a:0;return Math.max(o,r,1)})),t=Math.min(...l.map(e=>{const t=s[e].current,n=s[e].forecast,a=s[e].average,o=a>0?t/a:0,r=a>0?n/a:0;return Math.min(o,r,1)})),n=Math.max(e-1,1-t),a=Math.max(.2*n,.2),i=1+n+a,d=Math.max(1-n-a,0);o&&(o.options.scales.r.max=i,o.options.scales.r.min=d),r&&(r.options.scales.y.max=i,r.options.scales.y.min=d)}else if(o&&(o.options.scales.r.max=100,o.options.scales.r.min=0),r){const e=Math.max(...l.map(e=>{const t=s[e].current,n=s[e].forecast,a=s[e].average;return Math.max(t,n,a)})),t=Math.min(...l.map(e=>{const t=s[e].current,n=s[e].forecast,a=s[e].average;return Math.min(t,n,a)})),n=Math.max(.1*(e-t),5),a=e+n,o=Math.max(t-n,0);r.options.scales.y.max=a,r.options.scales.y.min=o}}kintone.events.on(["app.record.detail.show","app.record.edit.show","app.record.create.show"],function(n){return setTimeout(()=>{const _=kintone.app.record.getSpaceElement(a.spaceId);_?async function(n,_){var f,b,T,C,I;try{!function(e){e.innerHTML='\n      <div class="loading-container" style="\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 40px;\n        font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n      ">\n        <div class="loading-spinner" style="\n          width: 40px;\n          height: 40px;\n          border: 4px solid #f3f3f3;\n          border-top: 4px solid #3498db;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n          margin-bottom: 16px;\n        "></div>\n        <div class="loading-text" style="\n          color: #666;\n          font-size: 14px;\n          text-align: center;\n        ">データを読み込み中...</div>\n        <style>\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        </style>\n      </div>\n    '}(n);const $=a.propertyAppId,F=a.ownerAppId,B=_&&a.currentAppOwnerId&&(null==(f=_[a.currentAppOwnerId])?void 0:f.value)||"",R={};async function w(e,t,n){if(!e)return{records:[]};const a=/^-?\d+(?:\.\d+)?$/.test(String(n||"").trim());if(t&&""!==n&&null!=n){try{const a=await kintone.api("/k/v1/records.json","GET",{app:e,query:`${t} = "${n}"`});if(Array.isArray(a.records)&&a.records.length>0)return a}catch(o){}if(a)try{const a=await kintone.api("/k/v1/records.json","GET",{app:e,query:`${t} = ${n}`});if(Array.isArray(a.records)&&a.records.length>0)return a}catch(o){}}try{return await p(e)}catch(o){return{records:[]}}}async function P(){var e,t;try{const n=await async function(e,t={},n=500){const a=e.map(e=>p(e,t[e]||"",n)),o=await Promise.all(a),r={};return e.forEach((e,t)=>{r[e]=o[t]}),r}([F,$],{},500);return{owners:(null==(e=n[F])?void 0:e.records)||[],properties:(null==(t=n[$])?void 0:t.records)||[]}}catch(n){return console.error("全オーナーデータの取得に失敗:",n),{owners:[],properties:[]}}}B&&a.propertyOwnerId&&(R[$]=`${a.propertyOwnerId} = "${B}"`),B&&a.ownerId&&(R[F]=`${a.ownerId} = "${B}"`);const[M,L,A]=await Promise.all([w($,a.propertyOwnerId,B),w(F,a.ownerId,B),P()]);try{a.ownerId,a.propertyOwnerId,null==(b=M.records)||b.length,null==(T=L.records)||T.length,null==(C=A.owners)||C.length,null==(I=A.properties)||I.length}catch(h){}const N=function(e,t,n){var o,r,i,l,d,c,u,s,p,m,v;function y(e,t){return e&&"object"==typeof e&&null!==e&&"value"in e?e:{value:t}}function g(e){return{property_name:y(null==e?void 0:e[a.propertyName],""),market_price:y(null==e?void 0:e[a.propMarketPrice],0),income:y(null==e?void 0:e[a.propIncome],0),inheritance_tax_value:y(null==e?void 0:e[a.propInheritanceTaxVal],0),property_tax:y(null==e?void 0:e[a.propPropTax],0),management_fee:y(null==e?void 0:e[a.propMgmtFee],0),building_repair_cost:y(null==e?void 0:e[a.propBldgRepair],0),restoration_cost:y(null==e?void 0:e[a.propRestoration],0),maintenance_cost:y(null==e?void 0:e[a.propMaint],0),net_income:y(null==e?void 0:e[a.propNetIncome],0),full_rent:y(null==e?void 0:e[a.propFullRent],0)}}function x(e){return e?{annual_rent:y(null==e?void 0:e[a.ownerAnnRent],0),annual_management_fee:y(null==e?void 0:e[a.ownerAnnMgmtFee],0),land_property_tax:y(null==e?void 0:e[a.ownerLandPropTax],0),building_property_tax:y(null==e?void 0:e[a.ownerBldgPropTax],0),long_term_repair_cost:y(null==e?void 0:e[a.ownerLongTermRepair],0),maintenance_cost:y(null==e?void 0:e[a.ownerMaint],0),loan_interest:y(null==e?void 0:e[a.ownerLoanInterest],0),depreciation:y(null==e?void 0:e[a.ownerDepreciation],0),annual_insurance_premium:y(null==e?void 0:e[a.ownerAnnInsurance],0),inheritance_tax_rate:y(void 0,0),borrowing_rate:y(void 0,0)}:null}const _=Array.isArray(e)?e.map(g):[],f=Array.isArray(t)&&t.length>0?x(t[0]):null;try{_[0]}catch(h){}let b=0,T=0,C=0,I=0,E=0;function $(e){const{owners:t,properties:n}=e,o={};n.forEach(e=>{var t;const n=null==(t=e[a.propertyOwnerId])?void 0:t.value;n&&(o[n]||(o[n]=[]),o[n].push(e))});const r=[];t.forEach(e=>{var t,n,i,l,d,c,u,s,p,m,v,y;const g=null==(t=e[a.ownerId])?void 0:t.value;if(!g)return;const h=o[g]||[];if(0===h.length)return;let _=0,f=0,b=0,T=0;h.forEach(e=>{var t,n,o,r,i,l,d,c;const u=parseFloat((null==(t=e[a.propIncome])?void 0:t.value)||0),s=parseFloat((null==(n=e[a.propInheritanceTaxVal])?void 0:n.value)||0),p=parseFloat((null==(o=e[a.propFullRent])?void 0:o.value)||0),m=parseFloat((null==(r=e[a.propPropTax])?void 0:r.value)||0)+parseFloat((null==(i=e[a.propMgmtFee])?void 0:i.value)||0)+parseFloat((null==(l=e[a.propBldgRepair])?void 0:l.value)||0)+parseFloat((null==(d=e[a.propRestoration])?void 0:d.value)||0)+parseFloat((null==(c=e[a.propMaint])?void 0:c.value)||0);_+=u,f+=s,b+=m,T+=p});const C=f>0?_/f*100:0,I=T>0?b/T*100:0;let E=0;h.forEach(e=>{var t;const n=parseFloat((null==(t=e[a.propMarketPrice])?void 0:t.value)||0);E+=n});const $=f>0?E/f*100:0,F=T>0?(_-b)/T*100:0,B=x(e);let R=0;if(B){const e=parseFloat((null==(n=B.annual_management_fee)?void 0:n.value)||0)+parseFloat((null==(i=B.land_property_tax)?void 0:i.value)||0)+parseFloat((null==(l=B.building_property_tax)?void 0:l.value)||0)+parseFloat((null==(d=B.long_term_repair_cost)?void 0:d.value)||0)+parseFloat((null==(c=B.maintenance_cost)?void 0:c.value)||0)+parseFloat((null==(u=B.loan_interest)?void 0:u.value)||0)+parseFloat((null==(s=B.depreciation)?void 0:s.value)||0)+parseFloat((null==(p=B.annual_insurance_premium)?void 0:p.value)||0);R=parseFloat((null==(m=B.annual_rent)?void 0:m.value)||0)-e}let w=0;R>4e7?w=45:R>18e6?w=40:R>9e6?w=33:R>695e4?w=23:R>33e5?w=20:R>195e4?w=10:R>0&&(w=5);const P=x(e),M=parseFloat((null==(v=null==P?void 0:P.inheritance_tax_rate)?void 0:v.value)||0),L=parseFloat((null==(y=null==P?void 0:P.borrowing_rate)?void 0:y.value)||0);r.push({assetEfficiency:$,roa:C,operatingCostRate:I,incomeTaxRate:w,inheritanceTaxRate:M,borrowingRate:L,noiRate:F})});const i={assetEfficiency:0,roa:0,operatingCost:0,incomeTax:0,inheritanceTax:0,borrowing:0,noi:0};if(r.length>0){const e=r.reduce((e,t)=>(e.assetEfficiency+=t.assetEfficiency,e.roa+=t.roa,e.operatingCost+=t.operatingCostRate,e.incomeTax+=t.incomeTaxRate,e.inheritanceTax+=t.inheritanceTaxRate,e.borrowing+=t.borrowingRate,e.noi+=t.noiRate,e),{assetEfficiency:0,roa:0,operatingCost:0,incomeTax:0,inheritanceTax:0,borrowing:0,noi:0}),t=r.length;i.assetEfficiency=e.assetEfficiency/t,i.roa=e.roa/t,i.operatingCost=e.operatingCost/t,i.incomeTax=e.incomeTax/t,i.inheritanceTax=e.inheritanceTax/t,i.borrowing=e.borrowing/t,i.noi=e.noi/t}return i}_.forEach(e=>{var t,n,a,o,r,i,l,d,c,u,s;b+=parseFloat((null==(t=e.market_price)?void 0:t.value)||0),T+=parseFloat((null==(n=e.income)?void 0:n.value)||0),C+=parseFloat((null==(a=e.inheritance_tax_value)?void 0:a.value)||0);const p=parseFloat((null==(o=e.property_tax)?void 0:o.value)||0)+parseFloat((null==(r=e.management_fee)?void 0:r.value)||0)+parseFloat((null==(i=e.building_repair_cost)?void 0:i.value)||0)+parseFloat((null==(l=e.restoration_cost)?void 0:l.value)||0)+parseFloat((null==(d=e.maintenance_cost)?void 0:d.value)||0);I+=p;const m=parseFloat((null==(c=e.full_rent)?void 0:c.value)||0);E+=m,parseFloat((null==(u=e.income)?void 0:u.value)||0),parseFloat((null==(s=e.inheritance_tax_value)?void 0:s.value)||0)});const F=$(n||{owners:[],properties:[]}),B=C>0?T/C*100:0,R=E>0?I/E*100:0,w=T-I,P=E>0?w/E*100:0;let M=0,L=0,A=0;if(f){const e=parseFloat((null==(o=f.annual_management_fee)?void 0:o.value)||0)+parseFloat((null==(r=f.land_property_tax)?void 0:r.value)||0)+parseFloat((null==(i=f.building_property_tax)?void 0:i.value)||0)+parseFloat((null==(l=f.long_term_repair_cost)?void 0:l.value)||0)+parseFloat((null==(d=f.maintenance_cost)?void 0:d.value)||0)+parseFloat((null==(c=f.loan_interest)?void 0:c.value)||0)+parseFloat((null==(u=f.depreciation)?void 0:u.value)||0)+parseFloat((null==(s=f.annual_insurance_premium)?void 0:s.value)||0);M=parseFloat((null==(p=f.annual_rent)?void 0:p.value)||0)-e,L=parseFloat((null==(m=f.inheritance_tax_rate)?void 0:m.value)||0),A=parseFloat((null==(v=f.borrowing_rate)?void 0:v.value)||0)}let N=0;M>4e7?N=45:M>18e6?N=40:M>9e6?N=33:M>695e4?N=23:M>33e5?N=20:M>195e4?N=10:M>0&&(N=5);return{assetEfficiency:{current:B,average:F.assetEfficiency,forecast:B},roa:{current:B,average:F.roa,forecast:B},incomeTax:{current:N,average:F.incomeTax,forecast:N},inheritanceTax:{current:L,average:F.inheritanceTax,forecast:L},borrowing:{current:A,average:F.borrowing,forecast:A},operatingCost:{current:R,average:F.operatingCost,forecast:R},noi:{current:P,average:F.noi,forecast:P},propertyDetails:_,ownerDetails:f,calculatedIncomeTaxable:M,calculatedIncomeTaxRate:N}}(M.records,L.records,A);s=N,function(n,a){!function(n,a){n.innerHTML="",n.classList.add("bi-dashboard-plugin");const o=document.createElement("div");o.className="container";const r=document.createElement("div");r.className="top-section",r.appendChild(function(e){const t=document.createElement("div");t.className="table-section";const n=c.map((t,n)=>{const a=l[n],o=e[a];return`<tr>\n            <td>${t}</td>\n            <td>${o.current.toFixed(1)}</td>\n            <td>${o.average.toFixed(1)}</td>\n            <td>${o.forecast.toFixed(1)}</td>\n        </tr>`}).join("");return t.innerHTML=`\n        <div class="table-container">\n            <table id="dataTable">\n                <thead>\n                    <tr>\n                        <th>項目名</th>\n                        <th>現状</th>\n                        <th>平均</th>\n                        <th>試算</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${n}\n                </tbody>\n            </table>\n        </div>\n    `,t}(a)),r.appendChild(function(){const e=document.createElement("div");return e.className="chart-section",e.innerHTML='\n        <div class="chart-container">\n            <div class="chart-controls">\n                <button class="chart-toggle-button active" data-chart="radar">レーダーチャート</button>\n                <button class="chart-toggle-button" data-chart="bar">棒グラフ</button>\n                <div class="compression-control">\n                    <input type="checkbox" id="compressionCheckbox" class="compression-checkbox">\n                    <label for="compressionCheckbox">平均を1として比較する</label>\n                </div>\n            </div>\n            <div class="chart-item">\n                <div id="radarChartContainer">\n                    <h3>財務指標レーダーチャート</h3>\n                    <div class="chart-canvas-wrap"><canvas id="radarChart"></canvas></div>\n                </div>\n                <div id="barChartContainer" style="display: none;">\n                    <h3>財務指標棒グラフ</h3>\n                    <div class="chart-canvas-wrap"><canvas id="barChart"></canvas></div>\n                </div>\n            </div>\n        </div>\n    ',e}());const i=document.createElement("div");i.className="bottom-section";const d=function(){const e=document.createElement("div");e.className="tabs";const t=[{key:"roa",label:"資産効率・ROA",active:!0},{key:"operatingCost",label:"運営コスト率・NOI"},{key:"incomeTax",label:"所得税率"}];return e.innerHTML=t.map(e=>`\n        <button class="tab-button${e.active?" active":""}" data-tab="${e.key}">${e.label}</button>\n    `).join(""),e}();i.appendChild(d);const u=e(a);u.id="roaTab";const s=t(a);s.id="operatingCostTab";const p=function(e){var t,n,a,o,r,i,l,d,c;const{incomeTax:u,ownerDetails:s,calculatedIncomeTaxable:p,calculatedIncomeTaxRate:m}=e,v=document.createElement("div");function y(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function g(e){return parseFloat(e.replace(/,/g,""))||0}function x(e){const t=e.value.replace(/,/g,"");t&&!isNaN(t)&&(e.value=y(t))}function _(e,t){const n=[{rate:5,min:0,max:195e4},{rate:10,min:1950001,max:33e5},{rate:20,min:3300001,max:695e4},{rate:23,min:6950001,max:9e6},{rate:33,min:9000001,max:18e6},{rate:40,min:18000001,max:4e7},{rate:45,min:40000001,max:1/0}];let a=n.findIndex(t=>e>=t.min&&e<=t.max);if(-1===a&&(a=n.findIndex(e=>e.rate===t)),-1===a)return{lowerDiff:"0円",upperDiff:"0円"};const o=a>0?n[a-1]:null,r=a<n.length-1?n[a+1]:null,i=o?Math.max(0,e-o.max):0,l=r?Math.max(0,r.min-e):0;return{lowerDiff:y(i)+"円",upperDiff:y(l)+"円"}}function f(){const e=g(document.getElementById("incomeTaxCurrentIncome").value),t=parseInt(document.getElementById("incomeTaxCurrentTaxRate").value)||0,n=g(document.getElementById("incomeTaxForecastIncome").value),a=parseInt(document.getElementById("incomeTaxForecastTaxRate").value)||0;document.getElementById("currentIncomeDisplay").textContent=y(e)+"円",document.getElementById("currentRateDisplay").textContent=t+"%";const o=_(e,t);document.getElementById("currentLowerAmount").textContent=o.lowerDiff,document.getElementById("currentUpperAmount").textContent=o.upperDiff,document.getElementById("forecastIncomeDisplay").textContent=y(n)+"円",document.getElementById("forecastRateDisplay").textContent=a+"%";const r=_(n,a);document.getElementById("forecastLowerAmount").textContent=r.lowerDiff,document.getElementById("forecastUpperAmount").textContent=r.upperDiff}function b(){document.querySelectorAll(".tax-rate-table tbody tr").forEach(e=>{e.classList.remove("highlighted-current","highlighted-forecast")});const e=parseInt(document.getElementById("incomeTaxCurrentTaxRate").value)||0,t=parseInt(document.getElementById("incomeTaxForecastTaxRate").value)||0;if(e>0){const t=document.querySelector(`.tax-rate-table tbody tr[data-rate="${e}"]`);t&&t.classList.add("highlighted-current")}if(t>0){const e=document.querySelector(`.tax-rate-table tbody tr[data-rate="${t}"]`);e&&e.classList.add("highlighted-forecast")}}function T(e){const t=g(document.getElementById(`incomeTax${e}Rent`).value)-(g(document.getElementById(`incomeTax${e}Management`).value)+g(document.getElementById(`incomeTax${e}LandTax`).value)+g(document.getElementById(`incomeTax${e}BuildingTax`).value)+g(document.getElementById(`incomeTax${e}Repair`).value)+g(document.getElementById(`incomeTax${e}Maintenance`).value)+g(document.getElementById(`incomeTax${e}Interest`).value)+g(document.getElementById(`incomeTax${e}Depreciation`).value)+g(document.getElementById(`incomeTax${e}Insurance`).value)),n=function(e){return e<=0?0:e<=195e4?5:e<=33e5?10:e<=695e4?20:e<=9e6?23:e<=18e6?33:e<=4e7?40:45}(t);document.getElementById(`incomeTax${e}Income`).value=y(t),document.getElementById(`incomeTax${e}TaxRate`).value=n;const a={rowType:e,taxRate:n};if(document.dispatchEvent(new CustomEvent("incomeTax:taxRateUpdated",{detail:a})),window&&"function"==typeof window.setIncomeTaxRate)try{window.setIncomeTaxRate(e.toLowerCase(),n)}catch(h){}b(),f()}return v.className="tab-content",v.dataset.tab="incomeTax",v.innerHTML=`\n        <div class="form-container">\n            <table class="roa-table">\n                <thead>\n                    <tr>\n                        <th></th>\n                        <th>年賃料</th>\n                        <th>年管理費</th>\n                        <th>土地固都税</th>\n                        <th>建物固都税</th>\n                        <th>長期修繕計画経費</th>\n                        <th>メンテナンス経費</th>\n                        <th>借入金利息</th>\n                        <th>減価償却費</th>\n                        <th>保険料年額</th>\n                        <th>所得税課税所得</th>\n                        <th>所得税率</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr>\n                        <td class="row-label">現状値</td>\n                        <td><input type="text" id="incomeTaxCurrentRent" value="${(null==(t=null==s?void 0:s.annual_rent)?void 0:t.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentManagement" value="${(null==(n=null==s?void 0:s.annual_management_fee)?void 0:n.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentLandTax" value="${(null==(a=null==s?void 0:s.land_property_tax)?void 0:a.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentBuildingTax" value="${(null==(o=null==s?void 0:s.building_property_tax)?void 0:o.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentRepair" value="${(null==(r=null==s?void 0:s.long_term_repair_cost)?void 0:r.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentMaintenance" value="${(null==(i=null==s?void 0:s.maintenance_cost)?void 0:i.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentInterest" value="${(null==(l=null==s?void 0:s.loan_interest)?void 0:l.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentDepreciation" value="${(null==(d=null==s?void 0:s.depreciation)?void 0:d.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentInsurance" value="${(null==(c=null==s?void 0:s.annual_insurance_premium)?void 0:c.value)??0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentIncome" value="${p||0}" readonly></td>\n                        <td><input type="text" id="incomeTaxCurrentTaxRate" value="${m||0}" readonly></td>\n                    </tr>\n                    <tr>\n                        <td class="row-label">試算値</td>\n                        <td><input type="text" id="incomeTaxForecastRent" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastManagement" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastLandTax" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastBuildingTax" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastRepair" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastMaintenance" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastInterest" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastDepreciation" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastInsurance" value="0"></td>\n                        <td><input type="text" id="incomeTaxForecastIncome" value="0" readonly></td>\n                        <td><input type="text" id="incomeTaxForecastTaxRate" value="0" readonly></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        \n        <div class="calculation-formula-container">\n            <div class="formula-content">\n                <p>課税所得 = 年賃料 - (年管理費 + 土地固都税 + 建物固都税 + 長期修繕計画経費 + メンテナンス経費 + 借入金利息 + 減価償却費 + 保険料年額)</p>\n            </div>\n        </div>\n        \n        <div class="tax-info-container">\n            <div class="tax-rate-table-container">\n                <table class="tax-rate-table">\n                    <thead>\n                        <tr>\n                            <th>課税所得</th>\n                            <th>税率</th>\n                            <th>控除額</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr data-rate="5">\n                            <td>0円から1,950,000円まで</td>\n                            <td>5%</td>\n                            <td>0円</td>\n                        </tr>\n                        <tr data-rate="10">\n                            <td>1,950,001円から3,300,000円まで</td>\n                            <td>10%</td>\n                            <td>97,500円</td>\n                        </tr>\n                        <tr data-rate="20">\n                            <td>3,300,001円から6,950,000円まで</td>\n                            <td>20%</td>\n                            <td>427,500円</td>\n                        </tr>\n                        <tr data-rate="23">\n                            <td>6,950,001円から9,000,000円まで</td>\n                            <td>23%</td>\n                            <td>636,000円</td>\n                        </tr>\n                        <tr data-rate="33">\n                            <td>9,000,001円から18,000,000円まで</td>\n                            <td>33%</td>\n                            <td>1,536,000円</td>\n                        </tr>\n                        <tr data-rate="40">\n                            <td>18,000,001円から40,000,000円まで</td>\n                            <td>40%</td>\n                            <td>2,796,000円</td>\n                        </tr>\n                        <tr data-rate="45">\n                            <td>40,000,001円から</td>\n                            <td>45%</td>\n                            <td>4,796,000円</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n            \n            <div class="tax-difference-container">\n                <div class="difference-info">\n                    <div class="current-info">\n                        <h5>現状値</h5>\n                        <div id="currentDifferenceInfo">\n                            <p>課税所得: <span id="currentIncomeDisplay">0円</span></p>\n                            <p>適用税率: <span id="currentRateDisplay">0%</span></p>\n                            <p id="currentLowerDiff">一つ下の税率まで: <span id="currentLowerAmount">-</span></p>\n                            <p id="currentUpperDiff">一つ上の税率まで: <span id="currentUpperAmount">-</span></p>\n                        </div>\n                    </div>\n                    <div class="forecast-info">\n                        <h5>試算値</h5>\n                        <div id="forecastDifferenceInfo">\n                            <p>課税所得: <span id="forecastIncomeDisplay">0円</span></p>\n                            <p>適用税率: <span id="forecastRateDisplay">0%</span></p>\n                            <p id="forecastLowerDiff">一つ下の税率まで: <span id="forecastLowerAmount">-</span></p>\n                            <p id="forecastUpperDiff">一つ上の税率まで: <span id="forecastUpperAmount">-</span></p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,setTimeout(()=>{["incomeTaxCurrentRent","incomeTaxCurrentManagement","incomeTaxCurrentLandTax","incomeTaxCurrentBuildingTax","incomeTaxCurrentRepair","incomeTaxCurrentMaintenance","incomeTaxCurrentInterest","incomeTaxCurrentDepreciation","incomeTaxCurrentInsurance","incomeTaxCurrentIncome","incomeTaxCurrentTaxRate"].forEach(e=>{const t=document.getElementById(e);t&&x(t)});const e=document.getElementById("incomeTaxCurrentIncome").value,t=document.getElementById("incomeTaxCurrentTaxRate").value;"0"===e&&"0"===t?T("Current"):(b(),f()),["Rent","Management","LandTax","BuildingTax","Repair","Maintenance","Interest","Depreciation","Insurance"].forEach(e=>{const t=document.getElementById(`incomeTaxCurrent${e}`),n=document.getElementById(`incomeTaxForecast${e}`);t&&n&&(n.value=t.value)});const n=document.getElementById("incomeTaxCurrentIncome"),a=document.getElementById("incomeTaxCurrentTaxRate"),o=document.getElementById("incomeTaxForecastIncome"),r=document.getElementById("incomeTaxForecastTaxRate");n&&o&&(o.value=n.value),a&&r&&(r.value=a.value),["incomeTaxForecastRent","incomeTaxForecastManagement","incomeTaxForecastLandTax","incomeTaxForecastBuildingTax","incomeTaxForecastRepair","incomeTaxForecastMaintenance","incomeTaxForecastInterest","incomeTaxForecastDepreciation","incomeTaxForecastInsurance","incomeTaxForecastIncome","incomeTaxForecastTaxRate"].forEach(e=>{const t=document.getElementById(e);t&&x(t)}),T("Forecast"),["incomeTaxForecastRent","incomeTaxForecastManagement","incomeTaxForecastLandTax","incomeTaxForecastBuildingTax","incomeTaxForecastRepair","incomeTaxForecastMaintenance","incomeTaxForecastInterest","incomeTaxForecastDepreciation","incomeTaxForecastInsurance"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("input",e=>{x(e.target),T("Forecast")}),t.addEventListener("blur",e=>{x(e.target)}))})},200),v}(a);p.id="incomeTaxTab";const m=function(){const e=document.createElement("div");return e.className="tab-content",e.dataset.tab="inheritanceTax",e.innerHTML='\n        <div class="form-container">\n            <div class="unimplemented-message">\n                <h3>未実装</h3>\n                <p>機能追加のご依頼をお待ちしております。<br>ほっとビジネスサポート(株)</p>\n            </div>\n        </div>\n    ',e}(a.inheritanceTax);m.id="inheritanceTaxTab";const v=function(){const e=document.createElement("div");return e.className="tab-content",e.dataset.tab="borrowing",e.innerHTML='\n        <div class="form-container">\n            <div class="unimplemented-message">\n                <h3>未実装</h3>\n                <p>機能追加のご依頼をお待ちしております。<br>ほっとビジネスサポート(株)</p>\n            </div>\n        </div>\n    ',e}(a.borrowing);v.id="borrowingTab",i.appendChild(u),i.appendChild(s),i.appendChild(p),i.appendChild(m),i.appendChild(v),o.appendChild(r),o.appendChild(i),n.appendChild(o)}(n,a);const p=n.querySelector(".container");(function(e){if(!e)return;requestAnimationFrame(()=>{e.style.width="1400px",e.style.minWidth="1400px",e.style.maxWidth="1400px",e.style.boxSizing="border-box"})})(p),function(e){const t=document.getElementById("radarChart").getContext("2d"),n=document.getElementById("barChart").getContext("2d"),a=d.map((t,n)=>({label:u[n].label,data:y(t,e),borderColor:u[n].border,backgroundColor:u[n].bgRadar,borderWidth:u[n].bwRadar})),i=d.map((t,n)=>({label:u[n].label,data:y(t,e),backgroundColor:u[n].bgBar,borderColor:u[n].border,borderWidth:u[n].bwBar}));o=new Chart(t,{type:"radar",data:{labels:c,datasets:a},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,resizeDelay:100,scales:{r:{beginAtZero:!0,max:100,min:0}},plugins:{legend:{position:"bottom"}}}}),r=new Chart(n,{type:"bar",data:{labels:c,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,resizeDelay:100,scales:{y:{beginAtZero:!0,max:100,min:0}},plugins:{legend:{position:"bottom"}}}}),x()}(a),document.querySelectorAll('input[type="number"]').forEach(e=>{e.addEventListener("input",function(){const e=function(e){for(const t of d){const n=m(t);if(e.endsWith(n)){const a=e.slice(0,-n.length);if(l.includes(a))return{metric:a,field:t}}}return null}(this.id);if(!e)return;const{metric:t,field:n}=e;s[t][n]=parseFloat(this.value)||0,v(),g()})}),document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{!function(e){document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-button").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`.tab-content[data-tab="${e}"]`)||document.getElementById(`${e}Tab`),n=document.querySelector(`.tab-button[data-tab="${e}"]`);t&&t.classList.add("active"),n&&n.classList.add("active")}(e.dataset.tab)})}),document.querySelectorAll(".chart-toggle-button").forEach(e=>{e.addEventListener("click",()=>{!function(e){document.querySelectorAll(".chart-toggle-button").forEach(e=>e.classList.remove("active"));const t=document.getElementById("radarChartContainer"),n=document.getElementById("barChartContainer");if(t&&n)if(t.style.display="none",n.style.display="none","radar"===e){t.style.display="block";const e=document.querySelector('.chart-toggle-button[data-chart="radar"]');e&&e.classList.add("active"),requestAnimationFrame(()=>{o&&o.resize()})}else{n.style.display="block";const e=document.querySelector('.chart-toggle-button[data-chart="bar"]');e&&e.classList.add("active"),requestAnimationFrame(()=>{r&&r.resize()})}}(e.dataset.chart)})}),document.querySelectorAll(".compression-checkbox").forEach(e=>{e.addEventListener("change",()=>{!function(){const e=document.querySelector(".compression-checkbox");e&&(i=e.checked),x(),g()}()})}),document.addEventListener("incomeTax:taxRateUpdated",e=>{const t=e&&e.detail?e.detail:{},n=t.rowType,a=Number(t.taxRate)||0;"Current"===n?s.incomeTax.current=a:"Forecast"===n?s.incomeTax.forecast=a:"Average"===n&&(s.incomeTax.average=a),v(),g()}),window.setIncomeTaxRate=function(e,t){const n=(e||"").toLowerCase(),a=Number(t)||0;"current"===n&&(s.incomeTax.current=a),"forecast"===n&&(s.incomeTax.forecast=a),"average"===n&&(s.incomeTax.average=a),v(),g()},document.addEventListener("operatingCost:rateUpdated",e=>{const t=e&&e.detail?e.detail:{},n=t.rowType,a=Number(t.rate)||0;"Current"===n?s.operatingCost.current=a:"Forecast"===n&&(s.operatingCost.forecast=a),v(),g()}),v(),setTimeout(()=>{o&&o.resize(),r&&r.resize()},0)}(n,N)}catch(E){console.error("Failed to fetch or process kintone data:",E),n.innerHTML="<p>データの取得に失敗しました。</p>"}}(_,n&&n.record):a.spaceId},0),n})}()}();
