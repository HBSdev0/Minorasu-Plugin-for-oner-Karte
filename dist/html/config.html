<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BI Dashboard Plugin Settings</title>
    <link rel="stylesheet" href="../css/config.css">
</head>
<body>
    <div class="plugin-container">
        <main class="plugin-main">
            <div class="settings-section">
                <h2>全般設定</h2>
                <div class="space-config">
                    <div class="space-group">
                        <label for="spaceId">表示スペースID</label>
                        <input type="text" id="spaceId" class="space-input" placeholder="例: dashboard">
                        <p class="help-text">プラグインのダッシュボードを表示するスペースフィールドのIDを指定してください。</p>
                    </div>
                </div>
                
                <div class="current-app-config">
                    <div class="current-app-group">
                        <label for="currentAppOwnerId">自アプリ内のオーナーIDフィールド</label>
                        <select id="currentAppOwnerId" class="app-dropdown kintone-current-app-field-select">
                            <option value="">フィールドを選択してください</option>
                        </select>
                        <p class="help-text">このアプリ内でオーナーを識別するためのフィールドを選択してください。</p>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>データソース設定</h2>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="owner">①オーナーマスタ</button>
                        <button class="tab-button" data-tab="property">②物件マスタ</button>
                    </div>
                    
                    <div class="tab-content">
                        <div id="ownerTab" class="tab-pane active">
                            <div class="mapping-group">
                                <h3>オーナーマスタ の設定</h3>
                                
                                <div class="app-selection">
                                    <div class="app-group">
                                        <label for="ownerAppId">アプリを選択</label>
                                        <select id="ownerAppId" class="app-dropdown kintone-app-select"></select>
                                    </div>
                                </div>
                                
                                <h4>オーナーID設定</h4>
                                <div class="field-mappings" id="ownerIdMappings">
                                    <!-- Owner ID field will be dynamically added here by JS -->
                                </div>
                                
                                <h4>フィールドマッピング</h4>
                                <div class="field-mappings" id="ownerFieldMappings">
                                    <!-- Fields will be dynamically added here by JS -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="propertyTab" class="tab-pane">
                            <div class="mapping-group">
                                <h3>物件マスタの設定</h3>
                                
                                <div class="app-selection">
                                    <div class="app-group">
                                        <label for="propertyAppId">アプリを選択</label>
                                        <select id="propertyAppId" class="app-dropdown kintone-app-select"></select>
                                    </div>
                                </div>
                                
                                <h4>オーナーID設定</h4>
                                <div class="field-mappings" id="propertyOwnerIdMappings">
                                    <!-- Property Owner ID field will be dynamically added here by JS -->
                                </div>
                                
                                <h4>物件名設定</h4>
                                <div class="field-mappings" id="propertyNameMappings">
                                    <!-- Property Name field will be dynamically added here by JS -->
                                </div>
                                
                                <h4>フィールドマッピング</h4>
                                <div class="field-mappings" id="propertyFieldMappings">
                                    <!-- Fields will be dynamically added here by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>成績基準設定</h2>
                <p class="help-text">各指標の成績評価基準を設定できます。成績は1（低い）から5（高い）の5段階で評価されます。</p>
                
                <div class="grade-settings">
                    <div class="metric-group">
                        <h3>資産効率 (%)</h3>
                        <p class="metric-description">高いほど良い指標：実勢価格 ÷ 相続税評価額 × 100</p>
                        
                        <div class="grade-table" id="assetEfficiency_grade_table">
                            <div class="grade-ranges" id="assetEfficiency_grade_ranges"></div>
                            <button type="button" class="add-range-btn" data-metric="assetEfficiency">範囲を追加</button>
                        </div>
                    </div>

                    <div class="metric-group">
                        <h3>ROA (%)</h3>
                        <p class="metric-description">高いほど良い指標：収支 ÷ 相続税評価額 × 100</p>
                        
                        <div class="grade-table" id="roa_grade_table">
                            <div class="grade-ranges" id="roa_grade_ranges"></div>
                            <button type="button" class="add-range-btn" data-metric="roa">範囲を追加</button>
                        </div>
                    </div>

                    <div class="metric-group">
                        <h3>所得税率 (%)</h3>
                        <p class="metric-description">低いほど良い指標：税率が低いほど高評価</p>
                        
                        <div class="grade-table" id="incomeTax_grade_table">
                            <div class="grade-ranges" id="incomeTax_grade_ranges"></div>
                            <button type="button" class="add-range-btn" data-metric="incomeTax">範囲を追加</button>
                        </div>
                    </div>

                    <div class="metric-group">
                        <h3>運営コスト率 (%)</h3>
                        <p class="metric-description">低いほど良い指標：運営コスト ÷ 満室賃料 × 100</p>
                        
                        <div class="grade-table" id="operatingCost_grade_table">
                            <div class="grade-ranges" id="operatingCost_grade_ranges"></div>
                            <button type="button" class="add-range-btn" data-metric="operatingCost">範囲を追加</button>
                        </div>
                    </div>

                    <div class="metric-group">
                        <h3>NOI率 (%)</h3>
                        <p class="metric-description">高いほど良い指標：NOI ÷ 満室賃料 × 100</p>
                        
                        <div class="grade-table" id="noi_grade_table">
                            <div class="grade-ranges" id="noi_grade_ranges"></div>
                            <button type="button" class="add-range-btn" data-metric="noi">範囲を追加</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button type="button" id="plugin_cancel" class="btn btn-secondary">キャンセル</button>
                <button type="button" id="plugin_submit" class="btn btn-primary">設定を保存</button>
            </div>
        </main>
    </div>
</body>
</html>
